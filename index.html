<!DOCTYPE html>
<html>
<head>
    <title>Office Attendance</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; text-align: center; padding: 40px 20px; background: #f4f7f6; }
        #app { display: none; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { padding: 15px; width: 80%; margin: 20px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .btn { padding: 20px; width: 90%; color: white; border: none; border-radius: 10px; font-size: 20px; margin: 10px 0; cursor: pointer; font-weight: bold; }
        .login { background: #27ae60; } .logout { background: #e67e22; }
        #msg { color: #c0392b; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>
    <div id="app">
        <h2>Welcome to Office</h2>
        <input type="text" id="name" placeholder="Enter Your Full Name">
        <button id="loginBtn" class="btn login" onclick="send('LOGIN')">CLOCK IN</button>
        <button id="logoutBtn" class="btn logout" onclick="send('LOGOUT')">CLOCK OUT</button>
        <p id="msg"></p>
    </div>

    <script>
        const GOOGLE_URL = "YOUR_APPS_SCRIPT_URL_HERE"; // Ensure this is your latest /exec URL

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            const received = params.get('auth');
            const token = btoa(Math.floor(Date.now() / 30000)).substring(0,8);

            if (received === token) {
                document.getElementById('app').style.display = 'block';
                checkTime();
            } else {
                document.body.innerHTML = "<h2 style='color:red;'>‚ùå Expired Session.<br>Please scan the live QR on the Boss's phone again.</h2>";
            }
        };

        function checkTime() {
            const now = new Date();
            const mins = now.getHours() * 60 + now.getMinutes();
            if (mins > 615 && mins < 780) { // 10:15 AM to 1:00 PM
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('msg').innerText = "Login is currently closed.";
            }
        }

        async function send(type) {
            const name = document.getElementById('name').value;
            if(!name) return alert("Please enter your name");

            // Simplified data: No photo
            const payload = { name: name, type: type };

            try {
                await fetch(GOOGLE_URL, { 
                    method: 'POST', 
                    mode: 'no-cors', 
                    body: JSON.stringify(payload) 
                });
                alert(type + " Successful for " + name);
                window.location.href = "about:blank"; // Close/Clear page
            } catch (e) {
                alert("Error: " + e);
            }
        }
    </script>
</body>
</html>
